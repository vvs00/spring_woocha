<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/styles/search/search.css">
</head>
<body>

<!-- left navigation bar highlight -->
<input id="left-navigation-highlight" type="hidden" value=${page }>

<main id="content" class="search-main">
	<div></div>
	<div class="content-margin">
	    <div class="search_title-area">
			<div class="search_title-box">
				<div>
					<h2 class="search_title">
						비디오 장르
					</h2>
				</div>
			</div>
			<div class="show-more-button">
				<a class="show-more-button-link" href="/search/searchTitle?title='video_genre'">
					모두 보기
				</a>
			</div>
	    </div>
	    <div id="slider-class" class="search-content">
	    	<button type="button" class="slide-left-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M9.476.09c.452.226.65.805.44 1.295L1.985 20l7.933 18.615c.208.49.011 1.07-.44 1.295-.452.226-.987.012-1.196-.477L0 20 8.281.567c.209-.49.744-.703 1.195-.477Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    	<ul class="search-content_lists">
	    	</ul>
	    	<button type="button" class="slide-right-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M.524.09c-.452.226-.65.805-.44 1.295L8.015 20 .083 38.615c-.208.49-.011 1.07.44 1.295.452.226.987.012 1.196-.477L10 20 1.719.567C1.51.077.975-.136.524.09Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    </div>
	</div>
	
	<div class="content-margin">
	    <div class="search_title-area">
			<div class="search_title-box">
				<div>
					<h2 class="search_title">
						웹툰 장르
					</h2>
				</div>
			</div>
			<div class="show-more-button">
				<a class="show-more-button-link" href="/search/searchTitle?title='webtoon_genre'">
					모두 보기
				</a>
			</div>
	    </div>
	    <div id="slider-class" class="search-content">
	    	<button type="button" class="slide-left-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M9.476.09c.452.226.65.805.44 1.295L1.985 20l7.933 18.615c.208.49.011 1.07-.44 1.295-.452.226-.987.012-1.196-.477L0 20 8.281.567c.209-.49.744-.703 1.195-.477Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    	<ul class="search-content_lists">
	    	</ul>
	    	<button type="button" class="slide-right-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M.524.09c-.452.226-.65.805-.44 1.295L8.015 20 .083 38.615c-.208.49-.011 1.07.44 1.295.452.226.987.012 1.196-.477L10 20 1.719.567C1.51.077.975-.136.524.09Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    </div>
	</div>
	
	<div class="content-margin">
	    <div class="search_title-area">
			<div class="search_title-box">
				<div>
					<h2 class="search_title">
						비디오 국가
					</h2>
				</div>
			</div>
			<div class="show-more-button">
				<a class="show-more-button-link" href="/search/searchTitle?title='video_nation'">
					모두 보기
				</a>
			</div>
	    </div>
	    <div id="slider-class" class="search-content">
	    	<button type="button" class="slide-left-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M9.476.09c.452.226.65.805.44 1.295L1.985 20l7.933 18.615c.208.49.011 1.07-.44 1.295-.452.226-.987.012-1.196-.477L0 20 8.281.567c.209-.49.744-.703 1.195-.477Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    	<ul class="search-content_lists">
	    	</ul>
	    	<button type="button" class="slide-right-slidernav">
	    		<span>
	    			<svg width="10" height="40" viewBox="0 0 10 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
	    				<path fill-rule="evenodd" clip-rule="evenodd" d="M.524.09c-.452.226-.65.805-.44 1.295L8.015 20 .083 38.615c-.208.49-.011 1.07.44 1.295.452.226.987.012 1.196-.477L10 20 1.719.567C1.51.077.975-.136.524.09Z" fill="#FAADB4"></path>
	    			</svg>
	    		</span>
	    	</button>
	    </div>
	</div>
</main>

<script type="text/javascript" src="http://code.jquery.com/jquery-3.6.1.min.js"></script>
<script type="text/javascript">
let listPosition = [0,0,0];
let initialListLength = [0,0,0];
let rowNum;
let options = {
    root: null,
    rootMargin: "0px",
	threshold: 1
};
let callback = (entries, observer) => {
	entries.forEach((entry) => {
		//console.log(entry.intersectionRatio)
		if(entry.intersectionRatio==1){
			$(".slide-right-slidernav:eq("+rowNum+")").hide();
		}
	});
};
let observer = new IntersectionObserver(callback, options);

let timeout = null;
$(window).resize(function(){
	$(".slide-left-slidernav").hide();
	listPosition = [0,0,0];
	$(".search-content_lists").css("transform","translateX(0)");
	clearTimeout(timeout);
	timeout = setTimeout(function(){
		for(let i = 0; i < 3; i++){
			if($(".slide-right-slidernav:eq("+i+")").attr("style") == "display: none;"){
				$(".slide-right-slidernav:eq("+i+")").toggle();
				$(".slide-right-slidernav:eq("+i+")").removeAttr("style");
			}
		}
	},300)
});

// loads lists of titles from database onload
$(function(){
	$(".slide-left-slidernav").hide();
	search_grid_ajax();
});

$(".slide-left-slidernav").click(function(){
	rowNum = $(".slide-left-slidernav").index(this);
	listPosition[rowNum]+=100;
	
	if(listPosition[rowNum]==0)
		$(".slide-left-slidernav:eq("+rowNum+")").hide();
	if($(".slide-right-slidernav:eq("+rowNum+")").is(":hidden"))
		$(".slide-right-slidernav:eq("+rowNum+")").show();
	$(".search-content_lists:eq("+rowNum+")").css("transform","translateX("+listPosition[rowNum]+"%");
	$(".slide-left-slidernav").attr("disabled", true);
	setTimeout(function(){
		$(".slide-left-slidernav").attr("disabled", false);		
	},700);
});
$(".slide-right-slidernav").on("click",function(){
	rowNum = $(".slide-right-slidernav").index(this);
	listPosition[rowNum]-=100;
	
	$(".slide-left-slidernav:eq("+rowNum+")").show();
	$(".search-content_lists:eq("+rowNum+")").css("transform","translateX("+listPosition[rowNum]+"%)");
	$(".search-content_lists:eq("+rowNum+")").css("transition","750ms ease 0s");
	let target = $(".search-content_lists:eq("+rowNum+")").find(".search-content_list:eq("+(initialListLength[rowNum]-1)+")").get(0);
	$(".slide-right-slidernav").attr("disabled", true);
	setTimeout(function(){
		$(".slide-right-slidernav").attr("disabled", false);
	},700);
	observer.observe(target);
});

function search_grid_ajax(){
	$(".search_title").each(function(outsideIndex){
		let title = $(this)[0].innerText;
		if(title === "비디오 장르") title = "video_genre";
		else if(title === "웹툰 장르") title = "webtoon_genre";
		else if(title === "비디오 국가") title = "video_nation";
		$.ajax({
			url: "/search/getSearchTitle",
			type: "post",
			data: "title="+title,
			dataType: "json",
			success: function(data) {
				$.each(data, function(index, items){
					//console.log(index, items)
					$("<li/>",{class: "search-content_list", onclick: "location.href='/searchContent?domain="+title+"&tag="+items+"'"})
						.append($("<article/>")
							.append($("<a/>",{class: "search-content_list_link"})
								.append($("<div/>",{class: "search-link-box"})
									.append($("<img/>",{src: "/images/search/genre/"+title+"/"+(index+1)+".png"}))
									.append($("<div/>",{class: "search-link-box_title"})
										.append($("<p/>",{text: items}))
									)
								)
							)
						).appendTo($(".search-content_lists:eq("+outsideIndex+")"))
				});
			},
			error: function(err){
				console.log(err);
			}
		});
	});
}
</script>
</body>
</html>